<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="./Estilização/style.css">
</head>
<body onload="mostrar()">
    <div class="header">
        <img class="logo" src="Imagens/logoStarBooks.png">
        <ul class="navbar">
            <li> <a href="livros.html">Livros</a> </li>
            <li> | </li>
            <li> <a href="quiz.html">Quiz</a> </li>
            <li> | </li>
            <li> <a href="dashboard.html">Dashboard</a> </li>
            <li> | </li>
            <li class="atual"> <a href="perfil.html">Perfil</a> </li>
            <li> | </li>
            <li> <a href="index.html">Sair</a> </li>
        </ul>
    </div>
    <div class="background centro">
        <div class="tela_perfil">
            <div class="imagens_perfil">
                <img id="img_perfil" src="" class="perfil">
                <button onclick="mostrar_imagens()">Trocar foto de perfil</button>
                <div class="lista_imagens" id="imagens">
                    <img onclick="trocar(this.id, this.src)" id="1" src="Imagens/Luke.png">
                    <img onclick="trocar(this.id, this.src)" id="2" src="Imagens/Boba_Fett.png">
                    <img onclick="trocar(this.id, this.src)" id="3" src="Imagens/C3PO.png">
                    <img onclick="trocar(this.id, this.src)" id="4" src="Imagens/Thrawn.png">
                    <img onclick="trocar(this.id, this.src)" id="5" src="Imagens/Darth_Vader.png">
                    <img onclick="trocar(this.id, this.src)" id="6" src="Imagens/Joruus_C_Baoth.png">
                    <img onclick="trocar(this.id, this.src)" id="7" src="Imagens/Leia.png">
                    <img onclick="trocar(this.id, this.src)" id="8" src="Imagens/Darth_Revan.png">
                    <img onclick="trocar(this.id, this.src)" id="9" src="Imagens/Yoda.png">
                </div>
            </div>
            <h1>Nome: <span id="nome_user">Teste1</span> <br> <br>
                E-mail: <span id="email_user">teste1@gmail.com</span> <br> <br>
                Livro favorito: <span id="livro_favorito">Nenhum</span> <br>
                <select id="select_livro">
                    <option value="1">Escolha outro livro</option>
                    <option value="2">Herdeiro do Império</option>
                    <option value="3">Ascensão da Força Sombria</option>
                    <option value="4">O Último Comando</option>
                    <option value="5">Caminho de Destruição</option>
                    <option value="6">Regra de Dois</option>
                    <option value="7">Dinastia do Mal</option>
                    <option value="8">A Ascensão e a Queda de Darth Vader</option>
                    <option value="9">A Origem e a Lenda de Obi Wan Kenobi</option>
                    <option value="10">A Vida de Luke Skywalker</option>
                    <option value="11">O Livro dos Sith</option>
                    <option value="12">O Caminho Jedi</option>
                    <option value="13">Código do Caçador de Recompensas</option>
                    <option value="14">Manual do Império</option>
                    <option value="15">Troopers da Morte</option>
                    <option value="16">Sombras do Império</option>
                </select>
                <button onclick="favoritar()">Favoritar</button>
            </h1>
        </div>
    </div>
    <div class="footer">
        <img class="logo" src="Imagens/logoStarBooks.png">
        <div class="contato">
            <h2>Entre em contato:</h2>
            <div class="lista_contatos">
                <h3>&phone; (11) 96574-9168</h3>
                <h3>&#9993; bruno.ytakahashi@sptech.school</h3>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    function mostrar_imagens() {
        imagens.style.display = "block";
    }

    function mostrar() {
        var email = sessionStorage.EMAIL_USUARIO;
        var nome = sessionStorage.NOME_USUARIO;
        var foto = sessionStorage.CAMINHO_FOTO;
        var id_user = sessionStorage.ID_USUARIO;

        fetch("/favorito/mostrarLivro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idServer: id_user
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO mostrar()!")
            if (resposta.ok) {
                console.log(resposta);
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.LIVRO_FAVORITO = json.titulo;
                });
                var livroFavorito = sessionStorage.LIVRO_FAVORITO;
                var livro = document.getElementById("livro_favorito");
                if (livroFavorito == null) {
                    livro.innerHTML = "Nenhum";
                } else {
                    livro.innerHTML = livroFavorito;
                }
            }
        })

        console.log(foto);
        var nome_user = document.getElementById("nome_user");
        var email_user = document.getElementById("email_user");
        var perfil = document.getElementById("img_perfil");

        if (email != null && nome != null && foto != null) {
            nome_user.innerHTML = nome;
            email_user.innerHTML = email;
            perfil.src = foto;
        }
    }

    function trocar(id, src) {
        img_perfil.src = src;
        sessionStorage.CAMINHO_FOTO = src;
        imagens.style.display = "none";
        var idFoto = id;
        var id_user = sessionStorage.ID_USUARIO;

        fetch("/perfil/trocar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fotoServer: idFoto,
                idServer: id_user
            }),
            })
            .then(function (resposta) {
                console.log("resposta: ", resposta);
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;
    }

    function favoritar() {
        var select_livro = document.getElementById("select_livro");
        var id_livro = Number(select_livro.value);
        var id_user = sessionStorage.ID_USUARIO;
        
        if (id_livro == 1) {
            console.log("Nenhum livro selecionado");
        } else {
            livro_favorito.innerHTML = select_livro.options[select_livro.selectedIndex].text;
            fetch("/favorito/favoritar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    livroServer: id_livro,
                    idServer: id_user
                }),
                })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
    
                return false;
        }
    }
</script>